{% extends 'base.html.twig' %}

{% block title %}Bien{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
    <style>
        /* Ajoutez vos styles CSS personnalisés ici */
        #map {
            height: 300px; /* Hauteur de la mini-carte */
            width: 100%;
        }
    </style>
{% endblock %}

{% block body %}
    <h1 style="color: rgb(31, 153, 27);">Bien</h1>

    <div id="map"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var map = L.map('map').setView([0, 0], 13); // Niveau de zoom moyen pour une mini-carte
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
        
            const address = "{{ bien.adresse }}"; // Utilisation de l'adresse du bien
        
            axios.get('https://api.opencagedata.com/geocode/v1/json', {
                params: {
                    q: address,
                    key: 'efdde3d4de7f4af599a4e20df57db355'
                }
            })
            .then(response => {
                if (response.data.results.length > 0) {
                    const location = response.data.results[0].geometry;
                    const lat = location.lat;
                    const lng = location.lng;
        
                    // Marquer l'adresse sur la carte avec un marqueur rouge
                    var redIcon = L.icon({
                        iconUrl: 'public/img/marker-icon-2x-red.png',
                        shadowUrl: 'public/img/marker-shadow.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41],
                        popupAnchor: [1, -34],
                        shadowSize: [41, 41]
                    });
        
                    L.marker([lat, lng], {icon: redIcon}).addTo(map);
                    
                    // Centrer la carte sur l'adresse
                    map.setView([lat, lng]); // Pas besoin de spécifier le niveau de zoom pour une mini-carte
                } else {
                    console.error('Adresse non trouvée');
                }
            })
            .catch(error => {
                console.error('Erreur de géocodage:', error);
            });
        });
        
    </script>

    <table class="table">
        <tbody>
            <tr>
                <th style="color: rgb(46, 149, 204);">RefB</th>
                <td>{{ bien.refB }}</td>
            </tr>
            <tr>
                <th style="color: rgb(46, 149, 204);">Name</th>
                <td>{{ bien.name }}</td>
            </tr>
            <tr>
                <th style="color: rgb(46, 149, 204);">Adresse</th>
                <td>{{ bien.adresse }}</td>
            </tr>
            <tr>
                <th style="color: rgb(46, 149, 204);">NbrChambre</th>
                <td>{{ bien.nbrChambre }}</td>
            </tr>
            <tr>
                <th style="color: rgb(46, 149, 204);">Prix</th>
                <td>{{ bien.prix }}</td>
            </tr>
            <tr>
                <th style="color: rgb(46, 149, 204);">Type</th>
                <td>{{ bien.type }}</td>
            </tr>
            <tr>
                <th style="color: rgb(46, 149, 204);">Image</th>
                <td>{% if bien.image %}
                    <img src="{{ asset('/uploads/' ~ bien.image) }}"  style="max-width: 100px; max-height: 100px;">
                {% else %}
                    Aucune image disponible
                {% endif %}</td>
            </tr>
        </tbody>
    </table>

    <a href="{{ path('app_visite_new') }}" class="btn-demander-visite">Demander visite</a>
    {{ include('bien/_delete_form.html.twig') }}
    
{% endblock %}
